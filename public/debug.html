<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®åº“çŠ¶æ€æ£€æŸ¥</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status-item {
      margin: 15px 0;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #ddd;
    }
    .status-success {
      background: #f0f9ff;
      border-left-color: #10b981;
      color: #065f46;
    }
    .status-error {
      background: #fef2f2;
      border-left-color: #ef4444;
      color: #991b1b;
    }
    .status-warning {
      background: #fffbeb;
      border-left-color: #f59e0b;
      color: #92400e;
    }
    .status-info {
      background: #f0f9ff;
      border-left-color: #3b82f6;
      color: #1e40af;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #2563eb;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    pre {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 14px;
    }
    .loading {
      color: #6b7280;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” æ•°æ®åº“çŠ¶æ€æ£€æŸ¥</h1>
    <p>è¿™ä¸ªé¡µé¢å¸®åŠ©ä½ è¯Šæ–­æ•°æ®åº“è¿æ¥å’Œé…ç½®é—®é¢˜ã€‚</p>

    <div class="status-item status-info">
      <h3>ğŸ“‹ æ£€æŸ¥æ­¥éª¤</h3>
      <ol>
        <li>æ£€æŸ¥APIåŸºæœ¬è¿æ¥</li>
        <li>æ£€æŸ¥æ•°æ®åº“ç»‘å®šçŠ¶æ€</li>
        <li>æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„</li>
        <li>æµ‹è¯•åŸºæœ¬æ•°æ®æ“ä½œ</li>
      </ol>
    </div>

    <button onclick="runAllChecks()">ğŸš€ å¼€å§‹æ£€æŸ¥</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤ç»“æœ</button>

    <div id="results"></div>
  </div>

  <script>
    const results = document.getElementById('results');

    function addResult(title, content, type = 'info') {
      const div = document.createElement('div');
      div.className = `status-item status-${type}`;
      div.innerHTML = `<h3>${title}</h3><div>${content}</div>`;
      results.appendChild(div);
    }

    function clearResults() {
      results.innerHTML = '';
    }

    async function runAllChecks() {
      clearResults();

      // æ£€æŸ¥1: APIåŸºæœ¬è¿æ¥
      addResult('ğŸ”„ æ£€æŸ¥1: APIåŸºæœ¬è¿æ¥', '<span class="loading">æ£€æŸ¥ä¸­...</span>');
      try {
        const response = await fetch('/api/status');
        const data = await response.json();

        if (response.ok) {
          addResult('âœ… æ£€æŸ¥1: APIåŸºæœ¬è¿æ¥', `
            <p><strong>çŠ¶æ€:</strong> ${response.status} ${response.statusText}</p>
            <p><strong>å“åº”:</strong></p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'success');
        } else {
          addResult('âŒ æ£€æŸ¥1: APIåŸºæœ¬è¿æ¥', `
            <p><strong>é”™è¯¯:</strong> ${response.status} ${response.statusText}</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'error');
        }
      } catch (error) {
        addResult('âŒ æ£€æŸ¥1: APIåŸºæœ¬è¿æ¥', `
          <p><strong>ç½‘ç»œé”™è¯¯:</strong> ${error.message}</p>
          <p>å¯èƒ½åŸå› ï¼š</p>
          <ul>
            <li>Functionsæœªæ­£ç¡®éƒ¨ç½²</li>
            <li>APIè·¯ç”±é…ç½®é”™è¯¯</li>
            <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
          </ul>
        `, 'error');
      }

      // æ£€æŸ¥2: æ•°æ®åº“ç»‘å®š
      addResult('ğŸ”„ æ£€æŸ¥2: æ•°æ®åº“ç»‘å®šçŠ¶æ€', '<span class="loading">æ£€æŸ¥ä¸­...</span>');
      try {
        const response = await fetch('/api/bookmarks?limit=1');
        const data = await response.json();

        if (data.success) {
          addResult('âœ… æ£€æŸ¥2: æ•°æ®åº“ç»‘å®šçŠ¶æ€', `
            <p><strong>æ•°æ®åº“å·²æ­£ç¡®ç»‘å®š</strong></p>
            <p>å¯ä»¥æ­£å¸¸æŸ¥è¯¢æ•°æ®</p>
          `, 'success');
        } else if (data.message && data.message.includes('æ•°æ®åº“æœªç»‘å®š')) {
          addResult('âŒ æ£€æŸ¥2: æ•°æ®åº“ç»‘å®šçŠ¶æ€', `
            <p><strong>æ•°æ®åº“æœªç»‘å®š</strong></p>
            <p>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç»‘å®šD1æ•°æ®åº“ï¼š</p>
            <ol>
              <li>åœ¨Cloudflare Dashboardä¸­åˆ›å»ºD1æ•°æ®åº“</li>
              <li>åœ¨Pagesé¡¹ç›®è®¾ç½®ä¸­ç»‘å®šæ•°æ®åº“ï¼ˆå˜é‡åï¼šDBï¼‰</li>
              <li>é‡æ–°éƒ¨ç½²é¡¹ç›®</li>
            </ol>
          `, 'error');
        } else {
          addResult('âš ï¸ æ£€æŸ¥2: æ•°æ®åº“ç»‘å®šçŠ¶æ€', `
            <p><strong>æ•°æ®åº“å·²ç»‘å®šï¼Œä½†å¯èƒ½éœ€è¦åˆå§‹åŒ–</strong></p>
            <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${data.message}</p>
          `, 'warning');
        }
      } catch (error) {
        addResult('âŒ æ£€æŸ¥2: æ•°æ®åº“ç»‘å®šçŠ¶æ€', `
          <p><strong>æ£€æŸ¥å¤±è´¥:</strong> ${error.message}</p>
        `, 'error');
      }

      // æ£€æŸ¥3: è®¾ç½®API
      addResult('ğŸ”„ æ£€æŸ¥3: è®¾ç½®APIçŠ¶æ€', '<span class="loading">æ£€æŸ¥ä¸­...</span>');
      try {
        const response = await fetch('/api/settings');
        const data = await response.json();

        if (data.success) {
          addResult('âœ… æ£€æŸ¥3: è®¾ç½®APIçŠ¶æ€', `
            <p><strong>è®¾ç½®APIæ­£å¸¸</strong></p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'success');
        } else {
          addResult('âš ï¸ æ£€æŸ¥3: è®¾ç½®APIçŠ¶æ€', `
            <p><strong>è®¾ç½®APIæœ‰é—®é¢˜:</strong> ${data.message}</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'warning');
        }
      } catch (error) {
        addResult('âŒ æ£€æŸ¥3: è®¾ç½®APIçŠ¶æ€', `
          <p><strong>è®¾ç½®APIå¤±è´¥:</strong> ${error.message}</p>
        `, 'error');
      }

      // æ£€æŸ¥4: ç»Ÿè®¡API
      addResult('ğŸ”„ æ£€æŸ¥4: ç»Ÿè®¡APIçŠ¶æ€', '<span class="loading">æ£€æŸ¥ä¸­...</span>');
      try {
        const response = await fetch('/api/stats');
        const data = await response.json();

        if (data.success) {
          addResult('âœ… æ£€æŸ¥4: ç»Ÿè®¡APIçŠ¶æ€', `
            <p><strong>ç»Ÿè®¡APIæ­£å¸¸</strong></p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'success');
        } else {
          addResult('âš ï¸ æ£€æŸ¥4: ç»Ÿè®¡APIçŠ¶æ€', `
            <p><strong>ç»Ÿè®¡APIæœ‰é—®é¢˜:</strong> ${data.message}</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'warning');
        }
      } catch (error) {
        addResult('âŒ æ£€æŸ¥4: ç»Ÿè®¡APIçŠ¶æ€', `
          <p><strong>ç»Ÿè®¡APIå¤±è´¥:</strong> ${error.message}</p>
        `, 'error');
      }

      // æ£€æŸ¥5: ä¹¦ç­¾æ•°æ®
      addResult('ğŸ”„ æ£€æŸ¥5: ä¹¦ç­¾æ•°æ®', '<span class="loading">æ£€æŸ¥ä¸­...</span>');
      try {
        const response = await fetch('/api/bookmarks?limit=5');
        const data = await response.json();

        if (data.success) {
          addResult('âœ… æ£€æŸ¥5: ä¹¦ç­¾æ•°æ®', `
            <p><strong>ä¹¦ç­¾APIæ­£å¸¸</strong></p>
            <p><strong>ä¹¦ç­¾æ•°é‡:</strong> ${data.total || 0}</p>
            <p><strong>è¿”å›æ•°æ®:</strong></p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, data.total > 0 ? 'success' : 'warning');
        } else {
          addResult('âš ï¸ æ£€æŸ¥5: ä¹¦ç­¾æ•°æ®', `
            <p><strong>ä¹¦ç­¾APIæœ‰é—®é¢˜:</strong> ${data.message}</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `, 'warning');
        }
      } catch (error) {
        addResult('âŒ æ£€æŸ¥5: ä¹¦ç­¾æ•°æ®', `
          <p><strong>ä¹¦ç­¾APIå¤±è´¥:</strong> ${error.message}</p>
        `, 'error');
      }

      addResult('ğŸ‰ æ£€æŸ¥å®Œæˆ', `
        <p>æ‰€æœ‰æ£€æŸ¥å·²å®Œæˆã€‚è¯·æ ¹æ®ä¸Šè¿°ç»“æœè¿›è¡Œç›¸åº”çš„ä¿®å¤æ“ä½œã€‚</p>
        <p><strong>å¸¸è§è§£å†³æ–¹æ¡ˆï¼š</strong></p>
        <ul>
          <li>å¦‚æœæ•°æ®åº“æœªç»‘å®šï¼šåœ¨Cloudflare Pagesè®¾ç½®ä¸­ç»‘å®šD1æ•°æ®åº“</li>
          <li>å¦‚æœéœ€è¦åˆå§‹åŒ–ï¼šè®¿é—® <a href="/admin.html">ç®¡ç†åå°</a> è¿›è¡Œåˆå§‹åŒ–</li>
          <li>å¦‚æœAPIé”™è¯¯ï¼šæ£€æŸ¥Functionséƒ¨ç½²çŠ¶æ€</li>
          <li>å¦‚æœä¹¦ç­¾æ•°é‡ä¸º0ï¼šéœ€è¦å…ˆæ·»åŠ ä¸€äº›ä¹¦ç­¾æ•°æ®</li>
        </ul>
      `, 'info');
    }
  </script>
</body>
</html>
